{% set backlink = "/" %}
{% extends "layout.html" %}
{% block header%}
	<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
	<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
	<style>
		form div {width:500px}
		.chklabel {font-weight: normal;}
	</style>
	<script type="text/javascript">
		var phenoSelect;
		var phenos;
		var genoSelect;
		var responseSelect;
		var covariateSelect;

		function loadPheno(pheno_id) {
			$.getJSON("/api/pheno/" + pheno_id).done(function(pheno) {
				phenos = pheno.meta.columns;
				var cols = [];
				pheno.meta.columns.forEach(function(col, idx) {
					cols.push({id: idx, text: col.name});	
				})
				responseSelect = $("#response").select2({
					data: cols,
					minimumResultsForSearch: 3
				});
				covariateSelect = $("#covariates").select2({
					data: cols
				});
				$("#model-form").css("visibility","visible").hide().fadeIn();
			});
		}

		$(function() {
			genoSelect = $("#genotype").select2({
				data: [{id:1, text:"Freeze 1"}, {id:2, text:"Freeze2"}],
				minimumResultsForSearch: 3
			})
			$("#covar_add_all").click(function(evt) {
				evt.preventDefault();
				resp = responseSelect.val();
				opts = []
				phenos.forEach(function(col, idx) {
					if (idx != resp) {
						opts.push(idx);
					}
				});
				covariateSelect.val(opts).trigger("change");
			});
			$("#covar_remove_all").click(function(evt) {
				evt.preventDefault();
				covariateSelect.val("").trigger("change");
			});
			$.getJSON("/api/pheno").done(function(resp) {
				var phenos = [];
				resp.forEach(function(p) {
					phenos.push({id: p.id, text:p.name})
				});
				phenoSelect = $("#phenotype").select2({
					data: phenos,
					minimumResultsForSearch: 3
				});
				loadPheno(resp[0].id)
			});
		})
	</script>
{% endblock %}
{% block content %}
	<h1>Build your model...</h1>
        <div class="section">
            <form class="form-horizontal vflex" method="post" action="/api/model" id="model-form" style="visibility:hidden">
				<div class="form-group">
					<label for="genotypes" class="control-label col-xs-2">Genotypes</label>
					<div class="col-xs-10">
						<select id="genotype" class="form-control"></select>
					</div>
				</div>
				<div class="form-group">
					<label for="phenotype" class="control-label col-xs-2">Phenotypes</label>
					<div class="col-xs-10">
						<select id="phenotype" class="form-control"></select>
					</div>
				</div>
				<div class="form-group">
					<label for="response" class="control-label col-xs-2">Response</label>
					<div class="col-xs-10">
						<select id="response" class="form-control"></select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-offset-2 col-xs-10">
						<label class="chklabel"><input id="resp_logtrans" type="checkbox"/> Log Transform Response</label>
					</div>
				</div>
				<div class="form-group">
					<label for="covariates" class="control-label col-xs-2">Covariates</label>
					<div class="col-xs-10">
						<select id="covariates" class="form-control" multiple="multiple"></select>
						<br/><a href="#" id="covar_add_all">Add All</a> - <a href="#" id="covar_remove_all">Remove All</a>
					</div>
				</div>
				<div class="form-group">
					<label for="model" class="control-label col-xs-2">Model</label>
					<div class="col-xs-10">
						<div class="radio">
							<label for="model-lm">
							<input type="radio" name="model" id="model-lm" value="lm" checked="checked">
							<p><strong>Linear Model</strong></p>
							<p>A simple linear model</p></label>
						</div>
						<div class="radio">
							<label for="model-burden">
							<input type="radio" name="model" id="model-burden" value="burden">
							<p><strong>Burden</strong></p>
							<p>A simple burden test</p></label>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-offset-2 col-xs-10">
						<button>Submit</button>
					</div>
				</div>
            </form>
        </div>
{% endblock %}
